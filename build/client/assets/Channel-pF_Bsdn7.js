var Te=Object.defineProperty;var me=t=>{throw TypeError(t)};var Qe=(t,e,s)=>e in t?Te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var ge=(t,e,s)=>Qe(t,typeof e!="symbol"?e+"":e,s),J=(t,e,s)=>e.has(t)||me("Cannot "+s);var i=(t,e,s)=>(J(t,e,"read from private field"),s?s.call(t):e.get(t)),g=(t,e,s)=>e.has(t)?me("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),h=(t,e,s,r)=>(J(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),d=(t,e,s)=>(J(t,e,"access private method"),s);import{w as ke}from"./with-props-5bye84R0.js";import{a as O,o as f}from"./chunk-KNED5TY2-D47WiFP7.js";import{b as De,S as Fe,v as be,w,x as ee,r as G,f as Ue,y as te,z as ve,B as Me,k as Ne,C as Le,D as ye,n as Se,E as Pe,c as F,a as Ie,F as _e}from"./QueryClientProvider-BRILHyXB.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ae=De("loader-circle",ze);var v,n,H,b,Q,M,S,I,V,N,L,k,D,j,P,a,$,se,ie,re,ne,ae,oe,ce,je,Oe,Be=(Oe=class extends Fe{constructor(e,s){super();g(this,a);g(this,v);g(this,n);g(this,H);g(this,b);g(this,Q);g(this,M);g(this,S);g(this,I);g(this,V);g(this,N);g(this,L);g(this,k);g(this,D);g(this,j);g(this,P,new Set);this.options=s,h(this,v,e),h(this,I,null),h(this,S,be()),this.options.experimental_prefetchInRender||i(this,S).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,n).addObserver(this),xe(i(this,n),this.options)?d(this,a,$).call(this):this.updateResult(),d(this,a,ne).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return he(i(this,n),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return he(i(this,n),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,d(this,a,ae).call(this),d(this,a,oe).call(this),i(this,n).removeObserver(this)}setOptions(e){const s=this.options,r=i(this,n);if(this.options=i(this,v).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof w(this.options.enabled,i(this,n))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");d(this,a,ce).call(this),i(this,n).setOptions(this.options),s._defaulted&&!ee(this.options,s)&&i(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,n),observer:this});const l=this.hasListeners();l&&Re(i(this,n),r,this.options,s)&&d(this,a,$).call(this),this.updateResult(),l&&(i(this,n)!==r||w(this.options.enabled,i(this,n))!==w(s.enabled,i(this,n))||G(this.options.staleTime,i(this,n))!==G(s.staleTime,i(this,n)))&&d(this,a,se).call(this);const c=d(this,a,ie).call(this);l&&(i(this,n)!==r||w(this.options.enabled,i(this,n))!==w(s.enabled,i(this,n))||c!==i(this,j))&&d(this,a,re).call(this,c)}getOptimisticResult(e){const s=i(this,v).getQueryCache().build(i(this,v),e),r=this.createResult(s,e);return He(this,r)&&(h(this,b,r),h(this,M,this.options),h(this,Q,i(this,n).state)),r}getCurrentResult(){return i(this,b)}trackResult(e,s){const r={};return Object.keys(e).forEach(l=>{Object.defineProperty(r,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),s==null||s(l),e[l])})}),r}trackProp(e){i(this,P).add(e)}getCurrentQuery(){return i(this,n)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,v).defaultQueryOptions(e),r=i(this,v).getQueryCache().build(i(this,v),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return d(this,a,$).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,b)))}createResult(e,s){var pe;const r=i(this,n),l=this.options,c=i(this,b),o=i(this,Q),E=i(this,M),R=e!==r?e.state:i(this,H),{state:_}=e;let u={..._},z=!1,p;if(s._optimisticResults){const x=this.hasListeners(),K=!x&&xe(e,s),U=x&&Re(e,r,s,l);(K||U)&&(u={...u,...Le(_.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:A,errorUpdatedAt:B,status:y}=u;p=u.data;let q=!1;if(s.placeholderData!==void 0&&p===void 0&&y==="pending"){let x;c!=null&&c.isPlaceholderData&&s.placeholderData===(E==null?void 0:E.placeholderData)?(x=c.data,q=!0):x=typeof s.placeholderData=="function"?s.placeholderData((pe=i(this,L))==null?void 0:pe.state.data,i(this,L)):s.placeholderData,x!==void 0&&(y="success",p=ye(c==null?void 0:c.data,x,s),z=!0)}if(s.select&&p!==void 0&&!q)if(c&&p===(o==null?void 0:o.data)&&s.select===i(this,V))p=i(this,N);else try{h(this,V,s.select),p=s.select(p),p=ye(c==null?void 0:c.data,p,s),h(this,N,p),h(this,I,null)}catch(x){h(this,I,x)}i(this,I)&&(A=i(this,I),p=i(this,N),B=Date.now(),y="error");const X=u.fetchStatus==="fetching",Y=y==="pending",Z=y==="error",de=Y&&X,fe=p!==void 0,C={status:y,fetchStatus:u.fetchStatus,isPending:Y,isSuccess:y==="success",isError:Z,isInitialLoading:de,isLoading:de,data:p,dataUpdatedAt:u.dataUpdatedAt,error:A,errorUpdatedAt:B,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>R.dataUpdateCount||u.errorUpdateCount>R.errorUpdateCount,isFetching:X,isRefetching:X&&!Y,isLoadingError:Z&&!fe,isPaused:u.fetchStatus==="paused",isPlaceholderData:z,isRefetchError:Z&&fe,isStale:ue(e,s),refetch:this.refetch,promise:i(this,S)};if(this.options.experimental_prefetchInRender){const x=W=>{C.status==="error"?W.reject(C.error):C.data!==void 0&&W.resolve(C.data)},K=()=>{const W=h(this,S,C.promise=be());x(W)},U=i(this,S);switch(U.status){case"pending":e.queryHash===r.queryHash&&x(U);break;case"fulfilled":(C.status==="error"||C.data!==U.value)&&K();break;case"rejected":(C.status!=="error"||C.error!==U.reason)&&K();break}}return C}updateResult(){const e=i(this,b),s=this.createResult(i(this,n),this.options);if(h(this,Q,i(this,n).state),h(this,M,this.options),i(this,Q).data!==void 0&&h(this,L,i(this,n)),ee(s,e))return;h(this,b,s);const r=()=>{if(!e)return!0;const{notifyOnChangeProps:l}=this.options,c=typeof l=="function"?l():l;if(c==="all"||!c&&!i(this,P).size)return!0;const o=new Set(c??i(this,P));return this.options.throwOnError&&o.add("error"),Object.keys(i(this,b)).some(E=>{const m=E;return i(this,b)[m]!==e[m]&&o.has(m)})};d(this,a,je).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&d(this,a,ne).call(this)}},v=new WeakMap,n=new WeakMap,H=new WeakMap,b=new WeakMap,Q=new WeakMap,M=new WeakMap,S=new WeakMap,I=new WeakMap,V=new WeakMap,N=new WeakMap,L=new WeakMap,k=new WeakMap,D=new WeakMap,j=new WeakMap,P=new WeakMap,a=new WeakSet,$=function(e){d(this,a,ce).call(this);let s=i(this,n).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Ue)),s},se=function(){d(this,a,ae).call(this);const e=G(this.options.staleTime,i(this,n));if(te||i(this,b).isStale||!ve(e))return;const r=Me(i(this,b).dataUpdatedAt,e)+1;h(this,k,setTimeout(()=>{i(this,b).isStale||this.updateResult()},r))},ie=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,n)):this.options.refetchInterval)??!1},re=function(e){d(this,a,oe).call(this),h(this,j,e),!(te||w(this.options.enabled,i(this,n))===!1||!ve(i(this,j))||i(this,j)===0)&&h(this,D,setInterval(()=>{(this.options.refetchIntervalInBackground||Ne.isFocused())&&d(this,a,$).call(this)},i(this,j)))},ne=function(){d(this,a,se).call(this),d(this,a,re).call(this,d(this,a,ie).call(this))},ae=function(){i(this,k)&&(clearTimeout(i(this,k)),h(this,k,void 0))},oe=function(){i(this,D)&&(clearInterval(i(this,D)),h(this,D,void 0))},ce=function(){const e=i(this,v).getQueryCache().build(i(this,v),this.options);if(e===i(this,n))return;const s=i(this,n);h(this,n,e),h(this,H,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},je=function(e){Se.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,b))}),i(this,v).getQueryCache().notify({query:i(this,n),type:"observerResultsUpdated"})})},Oe);function $e(t,e){return w(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function xe(t,e){return $e(t,e)||t.state.data!==void 0&&he(t,e,e.refetchOnMount)}function he(t,e,s){if(w(e.enabled,t)!==!1){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&ue(t,e)}return!1}function Re(t,e,s,r){return(t!==e||w(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&ue(t,s)}function ue(t,e){return w(e.enabled,t)!==!1&&t.isStaleByTime(G(e.staleTime,t))}function He(t,e){return!ee(t.getCurrentResult(),e)}var Ee=O.createContext(!1),Ve=()=>O.useContext(Ee);Ee.Provider;function qe(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ke=O.createContext(qe()),We=()=>O.useContext(Ke);function Ge(t,e){return typeof t=="function"?t(...e):!!t}function Ce(){}var Xe=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Ye=t=>{O.useEffect(()=>{t.clearReset()},[t])},Ze=({result:t,errorResetBoundary:e,throwOnError:s,query:r,suspense:l})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(l&&t.data===void 0||Ge(s,[t.error,r])),Je=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...s)=>Math.max(e(...s),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},et=(t,e)=>t.isLoading&&t.isFetching&&!e,tt=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,we=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function st(t,e,s){var u,z,p,A,B;const r=Pe(),l=Ve(),c=We(),o=r.defaultQueryOptions(t);(z=(u=r.getDefaultOptions().queries)==null?void 0:u._experimental_beforeQuery)==null||z.call(u,o),o._optimisticResults=l?"isRestoring":"optimistic",Je(o),Xe(o,c),Ye(c);const E=!r.getQueryCache().get(o.queryHash),[m]=O.useState(()=>new e(r,o)),R=m.getOptimisticResult(o),_=!l&&t.subscribed!==!1;if(O.useSyncExternalStore(O.useCallback(y=>{const q=_?m.subscribe(Se.batchCalls(y)):Ce;return m.updateResult(),q},[m,_]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),O.useEffect(()=>{m.setOptions(o)},[o,m]),tt(o,R))throw we(o,m,c);if(Ze({result:R,errorResetBoundary:c,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw R.error;if((A=(p=r.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||A.call(p,o,R),o.experimental_prefetchInRender&&!te&&et(R,l)){const y=E?we(o,m,c):(B=r.getQueryCache().get(o.queryHash))==null?void 0:B.promise;y==null||y.catch(Ce).finally(()=>{m.updateResult()})}return o.notifyOnChangeProps?R:m.trackResult(R)}function it(t,e){return st(t,Be)}function rt({className:t,...e}){return f.jsx("div",{"data-slot":"card",className:F("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...e})}function nt({className:t,...e}){return f.jsx("div",{"data-slot":"card-header",className:F("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...e})}function at({className:t,...e}){return f.jsx("div",{"data-slot":"card-title",className:F("leading-none font-semibold",t),...e})}function ot({className:t,...e}){return f.jsx("div",{"data-slot":"card-description",className:F("text-muted-foreground text-sm",t),...e})}function ct({className:t,...e}){return f.jsx("div",{"data-slot":"card-content",className:F("px-6",t),...e})}function ht({message:t}){return f.jsxs(rt,{children:[f.jsx(nt,{children:f.jsx(at,{children:t.owner_id})}),f.jsx(ct,{children:f.jsx(ot,{children:t.content})})]})}function lt({className:t,type:e,...s}){return f.jsx("input",{type:e,"data-slot":"input",className:F("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}const ut=Ie("flex-col items-center justify-center",{variants:{show:{true:"flex",false:"hidden"}},defaultVariants:{show:!0}}),dt=Ie("animate-spin text-primary",{variants:{size:{small:"size-6",medium:"size-8",large:"size-12"}},defaultVariants:{size:"medium"}});function ft({size:t,show:e,children:s,className:r}){return f.jsxs("span",{className:ut({show:e}),children:[f.jsx(Ae,{className:F(dt({size:t}),r)}),s]})}const T=class T{constructor(){}static getInstance(){return T.instance||(T.instance=new T),T.instance}getToken(){const s=localStorage.getItem("oidc.user:https://keycloak.hponthieu.org/realms/message:message-front");return s&&JSON.parse(s).access_token||null}};ge(T,"instance");let le=T;const pt="https://message-api.hponthieu.org",mt=async(t,e,s)=>{const r=le.getInstance().getToken();return console.log("Token",r),await(await fetch(`${pt}/messages/search?limit=${t}&page=${e}&query=${s}`,{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${r}`}})).json()},gt=(t,e,s)=>({queryKey:["messages",t,e,s],queryFn:()=>mt(t,e,s),staleTime:1e3*60*5});function bt(){const{data:t,isLoading:e}=it(gt(10,10,"hi"));return f.jsxs("div",{className:"flex flex-col p-2 h-full",children:[f.jsx(lt,{className:"w-1/2 outline-4"}),f.jsxs("div",{className:"flex flex-col p-2 gap-2 h-full",children:[t!=null&&!e&&(t==null?void 0:t.results.map(s=>f.jsx(ht,{message:s},s.id))),e&&f.jsx(ft,{}),!e&&(!t||t.results.length===0)&&f.jsx("div",{children:"No messages found"})]})]})}const vt=_e(bt,{OnRedirecting:()=>f.jsx("div",{children:"Redirecting..."})}),Ot=ke(vt);export{Ot as default};
